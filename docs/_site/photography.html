<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Photography 路 Joshua Mu</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
/* === Base (Minima-like) === */
body {
    margin: 0;
    font: 400 17px/1.7 -apple-system, BlinkMacSystemFont,
          "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    color: #111;
    background-color: #fdfdfd;
  }

  a {
    color: #2a7ae2;
    text-decoration: none;
  }

  a:hover {
    text-decoration: underline;
  }

  .wrapper {
    max-width: 760px;
    margin: 0 auto;
    padding: 0 20px;
  }

  /* Header */
  .site-header {
    border-top: 4px solid #424242;
    border-bottom: 1px solid #e8e8e8;
  }

  .site-header .wrapper {
  display: flex;
  justify-content: space-between;
  align-items: center;
  height: 56px;
}

.site-nav {
  display: flex;
  align-items: center;
  gap: 24px;   /* consistent spacing */
  font-size: 15px;
}
.site-nav a {
  display: inline-block;
  min-width: 40px; /* adjust as needed */
  text-align: right;
}


  .site-title {
    font-size: 22px;
    font-weight: 400;
    letter-spacing: -0.5px;
    margin: 0;
  }

  .site-title a {
    color: #111;
  }

  .site-nav a {
    margin-left: 24px;
    font-size: 15px;
    color: #424242;
  }

  .site-nav a[href="photography.html"] {
    font-size: 18px;
  }

  /* Content */
  .page-content {
    padding: 64px 0;
  }

  h1 {
    font-size: 36px;
    font-weight: 400;
    margin: 0 0 16px 0;
  }

  h2 {
    font-size: 22px;
    font-weight: 400;
    margin-top: 56px;
    margin-bottom: 10px;
  }

  p {
    max-width: 640px;
    margin-bottom: 18px;
  }

  .section-note {
    color: #666;
    font-size: 15px;
    margin-bottom: 20px;
  }

  .item {
    margin-bottom: 20px;
  }

  .item-title {
    font-weight: 500;
    margin-bottom: 4px;
  } 

/* === Justified gallery === */
.gallery {
  margin-top: 40px;
}

.gallery-row {
  display: flex;
  margin-bottom: 10px;
}

.gallery-row img {
  border-radius: 4px;
  margin-right: 10px;
  cursor: zoom-in;
  transition: transform 0.1s;
}

.gallery-row img:last-child {
  margin-right: 0;
}

.gallery-row img:hover {
  transform: scale(1.02);
}

/* === Lightbox === */
.lightbox {
  position: fixed;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  background: rgba(255,255,255,0.35);
  backdrop-filter: blur(18px) saturate(130%);
}

.lightbox-content {
  background: rgba(253,253,253,0.95);
  border-radius: 6px;
  padding: 20px;
  max-width: 80%;
  max-height: 80%;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.lightbox img {
  max-width: 100%;
  max-height: 65vh;
  cursor: default;
  user-select: none;
}

.caption {
  margin-top: 10px;
  font-size: 15px;
  color: #fff;
  background: rgba(0,0,0,0.55);
  padding: 6px 12px;
  border-radius: 4px;
  font-style: italic;
  text-align: center;
  max-width: 600px;
}

/* === Navigation === */
.nav-button {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  font-size: 36px;
  background: rgba(255,255,255,0.7);
  border-radius: 50%;
  border: none;
  width: 48px;
  height: 48px;
  cursor: pointer;
}

#prev { left: 40px; }
#next { right: 40px; }

/* === Thumbnails === */
.thumb-strip {
  display: flex;
  gap: 6px;
  margin-top: 12px;
  overflow-x: auto;
  scroll-behavior: smooth;
}

.thumb-strip img {
  width: 60px;
  height: 40px;
  object-fit: cover;
  opacity: 0.6;
  cursor: pointer;
  border: 2px solid transparent;
  border-radius: 3px;
}

.thumb-strip img.active {
  opacity: 1;
  border-color: #2a7ae2;
}

/* === Footer === */
.site-footer {
  border-top: 1px solid #e8e8e8;
  padding: 30px 0;
  margin-top: 60px;
  font-size: 14px;
  color: #828282;
}
</style>
</head>

<body>

<header class="site-header">
  <div class="wrapper">
    <h1 class="site-title"><a href="index.html"> main </a></h1>
    <nav class="site-nav">
      <a href="projects.html"> projects </a>
      <a href="photography.html" aria-label="photography" title="photography">[ ]</a>
    </nav>
  </div>
</header>

<main class="wrapper">
  <h1>Photography</h1>
  <div class="gallery" id="gallery"></div>
</main>

<footer class="site-footer">
  <div class="wrapper">漏 2026 Joshua Mu</div>
</footer>

<!-- === Lightbox === -->
<div class="lightbox" id="lightbox">
  <button class="nav-button" id="prev">&#8592;</button>
  <div class="lightbox-content">
    <img id="lightbox-img">
    <div class="caption" id="lightbox-caption"></div>
    <div class="thumb-strip" id="thumb-strip"></div>
  </div>
  <button class="nav-button" id="next">&#8594;</button>
</div>

<script>
const gallery = document.getElementById("gallery");
const lightbox = document.getElementById("lightbox");
const lightboxImg = document.getElementById("lightbox-img");
const captionEl = document.getElementById("lightbox-caption");
const thumbStrip = document.getElementById("thumb-strip");

let photos = [];
let currentIndex = 0;

/* === Load metadata === */
fetch("pics/meta/photos.json")
  .then(r => r.json())
  .then(data => {
    photos = data;
    buildGallery();
  });

/* === Build gallery and thumbnails === */
function buildGallery() {
  gallery.innerHTML = "";
  thumbStrip.innerHTML = "";

  photos.forEach((p, i) => {
    // === GRID IMAGE (SMALL THUMB) ===
    const img = document.createElement("img");
    img.src = `pics/gallery/${p.filename}`; 
    img.loading = "lazy";
    img.decoding = "async";
    img.dataset.index = i;
    img.onclick = () => open(i);

    // Wait for image to load before justifying
    img.onload = () => justify();

    gallery.appendChild(img);

    // === LIGHTBOX THUMB STRIP ===
    const t = document.createElement("img");
    t.src = `pics/gallery/${p.filename}`;
    t.onclick = () => show(i);
    thumbStrip.appendChild(t);
  });
}

/* === Justified layout === */
function justify() {
  const imgs = Array.from(gallery.querySelectorAll("img"));
  const containerWidth = gallery.clientWidth;
  const rowHeight = 220;
  let row = [], rowWidth = 0;

  gallery.innerHTML = "";

  imgs.forEach(img => {
    const aspect = img.naturalWidth / img.naturalHeight || 1.5;
    const width = rowHeight * aspect;
    row.push({ img, width });
    rowWidth += width;

    if (rowWidth >= containerWidth) {
      const scale = containerWidth / rowWidth;
      const rowDiv = document.createElement("div");
      rowDiv.className = "gallery-row";

      row.forEach(item => {
        item.img.style.height = rowHeight * scale + "px";
        rowDiv.appendChild(item.img);
      });

      gallery.appendChild(rowDiv);
      row = [];
      rowWidth = 0;
    }
  });

  if (row.length) {
    const rowDiv = document.createElement("div");
    rowDiv.className = "gallery-row";
    row.forEach(item => {
      item.img.style.height = rowHeight + "px";
      rowDiv.appendChild(item.img);
    });
    gallery.appendChild(rowDiv);
  }
}

window.addEventListener("resize", justify);

/* === Lightbox === */
function open(i) {
  currentIndex = i;
  lightbox.style.display = "flex";
  show(i);
  centerThumbnail(i);
}

function show(i) {
  currentIndex = i;
  const p = photos[i];

  //  Only load full image when needed
  lightboxImg.src = `pics/full/${p.filename}`;

  captionEl.innerHTML = `
    <i>${p.description || ""}</i><br>
    ${p.camera} 路 ${p.exposure.focal_length}
    路 f/${p.exposure.aperture}
    路 ${p.exposure.shutter}s 路 ISO ${p.exposure.iso}
  `;

  [...thumbStrip.children].forEach(t => t.classList.remove("active"));
  thumbStrip.children[i].classList.add("active");

  centerThumbnail(i);
}

/* === Scroll thumbnail strip so selected is centered === */
function centerThumbnail(i) {
  const thumb = thumbStrip.children[i];
  const stripWidth = thumbStrip.offsetWidth;
  const thumbCenter = thumb.offsetLeft + thumb.offsetWidth / 2;
  const scrollLeft = Math.max(0, thumbCenter - stripWidth / 2);
  thumbStrip.scrollTo({ left: scrollLeft, behavior: 'smooth' });
}

/* === Navigation === */
document.getElementById("prev").onclick = () =>
  show((currentIndex - 1 + photos.length) % photos.length);

document.getElementById("next").onclick = () =>
  show((currentIndex + 1) % photos.length);

lightbox.onclick = e => {
  if (e.target === lightbox) lightbox.style.display = "none";
};

document.addEventListener("keydown", e => {
  if (lightbox.style.display !== "flex") return;
  if (e.key === "ArrowLeft") document.getElementById("prev").click();
  if (e.key === "ArrowRight") document.getElementById("next").click();
  if (e.key === "Escape") lightbox.style.display = "none";
});
</script>


</body>
</html>
